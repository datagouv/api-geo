<!DOCTYPE html>
<html>
<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>API Communes</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.8/semantic.min.css"></link>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/default.min.css"></link>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css"></link>
</head>

<body>

  <div class="ui inverted blue vertical masthead center aligned segment">
    <h2><i class="circular lab icon"></i> API Communes </h2>
  </div>

  <!-- COMMUNES -->
  <div class="ui blue grid aligned segment">
    <div class="one wide column"></div>
    <div class="six wide column">
      <div class="ui top left attached blue label">Communes</div>
      <h2 class="ui aligned">/communes</h2>
      <p>Recherche de communes.</p>
    </div>
    <div class="height wide column">
      <div class="ui aligned segment">
        <p>Utiliser directement le <b>code Insee</b> de la commune pour récupérer tous les informations la concernant:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/communes/75056</div>
        <div class="ui warning message"><i class="warning icon"></i> Une <b>Erreur 404</b> sera renvoyé si le code Insee n'existe pas. </div>
        <p>Utiliser le paramètre <b>nom</b> pour faire une recherche par nom:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/communes?nom=paris</div>
        <p>Utiliser le paramètre <b>codeInsee</b> pour faire une recherche par code Insee:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/communes?codeInsee=75056</div>
        <p>Utiliser le paramètre <b>codePostal</b> pour faire une recherche par code postal:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/communes?codePostal=75001</div>
        <p>Utiliser les paramètres <b>lon</b> et <b>lat</b> pour faire une recherche par coordonnées géographique:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/communes?lon=1.359143768&lat=48.7483229</div>
        <p>Il est possible de demander un format de sortie <b>geojson</b>:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/communes?nom=rouen&format=geojson</div>
        <p>Utiliser le paramètre <b>geometry</b> permet de choisir l'option <b>contour</b> afin de recevoir les contours de la commune:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/communes?nom=rungis&geometry=contour&format=geojson</div>
      </div>
      <div class="ui aligned segment">
        <h4>Exemple de réponses</h4>
        <div class="ui secondary segment">
          <pre><code class="bash">$> curl https://geo.api.gouv.fr/communes?nom=dreux</code></pre>
          <pre><code class="json">[
  {
      "nom":"Dreux",
      "codeInsee":"28134",
      "codesPostaux":[
         "28100"
      ],
      "centre":{
         "type":"Point",
         "coordinates":[
            1.3591437681186405,
            48.74832295056131
         ]
      },
      "surface":2424,
      "_score":1
   }
]</code></pre>
      </div>
      <div class="ui info message">
        <p><b>nom</b>: Nom de la commune.</p>
        <p><b>codeInsee</b>: Code INSEE de la commune.</p>
        <p><b>codesPostaux</b>: Liste des codes postaux de la communes.</p>
        <p><b>centre</b>: Coordonnée géographique du point central de la commune.</p>
        <p><b>surface</b>: Surface de la commune en mètre.</p>
        <p><b>_score</b>: Valeur de 0 à 1 indiquant la pertinence du résultat.</p>
      </div>
      <h4>Exemple de réponse geojson</h4>
      <div class="ui secondary segment">
        <pre><code class="bash">$> curl https://geo.api.gouv.fr/communes?nom=dreux&format=geojson</code></pre>
        <pre><code class="json">{
  "type":"FeatureCollection",
  "features":[{
    "type":"Feature",
    "properties":{
      "nom":"Dreux",
      "codeInsee":"28134",
      "codesPostaux":["28100"],
      "surface":2424,
      "_score":1
    },
    "geometry":{
      "type":"Point",
      "coordinates":[1.3591437681186405,48.74832295056131]
    }
  }]
}</code></pre>
    </div>
    <div class="ui info message">
      <p>Le retour est un geojson FeatureCollection respectant la spec <a href="https://github.com/geocoders/geocodejson-spec">GeoCodeJSON</a>.</p>
    </div>
    </div>
    </div>
  <div class="one wide column"></div>
  </div>


  <!-- DEPARTEMENTS -->
  <div class="ui grid aligned segment">
    <div class="one wide column"></div>
    <div class="six wide column">
      <div class="ui basic top left attached label">Département</div>
      <h2 class="ui aligned">/departements</h2>
      <p>Recherche d'un département.</p>
    </div>
    <div class="height wide column">
      <div class="ui aligned segment">
        <p>Utiliser le paramètre <b>nom</b> pour faire une recherche par nom:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/departements?nom=paris</div>
        <p>Utiliser le paramètre <b>code</b> pour faire une recherche par code Insee:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/departements?code=75056</div>
        <p>Utiliser le paramètre <b>codeRegion</b> pour faire une recherche par code régionnal:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/departements?codeRegion=27</div>
      </div>
      <div class="ui aligned segment">
        <h4>Exemple de réponse</h4>
        <div class="ui secondary segment">
          <pre><code class="bash">$> curl https://geo.api.gouv.fr/departements?nom=eure</code></pre>
          <pre><code class="json">[
  {
    "nom":"Eure",
    "code":"27",
    "codeRegion":"28",
    "_score":1
  },
  {
    "nom":"Eure-et-Loir",
    "code":"28",
    "codeRegion":"24",
    "_score":0.6384933294190861
  }
]</code></pre>
        </div>
        <div class="ui info message">
          <p><b>nom</b>: Nom du département.</p>
          <p><b>code</b>: Code INSEE du département.</p>
          <p><b>codeRegion</b>: Code INSEE de la régions à la quelle appartient le département.</p>
          <p><b>_score</b>: Valeur de 0 à 1 indiquant la pertinence du résultat.</p>
        </div>
      </div>
    </div>
    <div class="one wide column"></div>
  </div>

  <!-- regions -->
  <div class="ui red grid aligned segment">
    <div class="one wide column"></div>
    <div class="six wide column">
      <div class="ui top left attached red label">Régions</div>
      <h2 class="ui aligned">/regions</h2>
      <p>Recherche une région.</p>
    </div>
    <div class="height wide column">
      <div class="ui aligned segment">
        <p>Utiliser le paramètre <b>nom</b> pour faire une recherche par nom:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/regions?nom=paris</div>
        <p>Utiliser le paramètre <b>code</b> pour faire une recherche par code Insee:</p>
        <div class="ui secondary segment">https://geo.api.gouv.fr/regions?code=11</div>
      </div>
      <div class="ui aligned segment">
        <h4>Exemple de réponse</h4>
        <div class="ui secondary segment">
          <pre><code class="bash">$> curl https://geo.api.gouv.fr/regions?nom=normandie</code></pre>
          <pre><code class="json">[
  {
    "nom":"Normandie",
    "code":"28",
    "_score":1
  }
]
        </code></pre>
        </div>
        <div class="ui info message">
          <p><b>nom</b>: Nom de la région.</p>
          <p><b>code</b>: Code INSEE de la région.</p>
          <p><b>_score</b>: Valeur de 0 à 1 indiquant la pertinence du résultat.</p>
        </div>
      </div>
    </div>
    <div class="one wide column"></div>
  </div>

  <h1 class="ui horizontal divider"> Essayer moi </h1>
<div class="ui aligned segment">
<div class="ui two column middle aligned very relaxed stackable grid">
  <div class="column">
    <div class="six wide column" id="mapid" style="height: 360px;"></div>
  </div>
  <div class="ui vertical divider"><i class="code icon"></i> </div>
  <div class="center aligned column">
    <div id="commune" style="display:none;">
      <h1 id="nom">Nom</h1>
      <p id="codeInsee"><b>Code Insee: </b></p>
      <p id="codesPostaux"><b>Codes postaux: </b></p>
      <p id="surface"><b>Surface: </b></p>
      <p id="gps"><b>Coordonnées: </b></p>
    </div>
    <div class="ui centered large inline loader"></div>
    <div class="ui big green labeled icon button" onclick="getLocation()"><i class="location arrow icon"></i> Trouver ma commune </div>
  </div>
</div>
</div>

<div class="ui divider"></div>

<div class="ui inverted vertical masthead center aligned segment">
  <h2><i class="circular lab icon"></i> API Communes </h2>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/1.0.0/fetch.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
function getLocation() {
  if (navigator.geolocation) {
    return navigator.geolocation.getCurrentPosition(locateUser);
  }
}

function initMap() {
    var options = {center : new L.LatLng(46.921982, 2.978952), zoom : 5 };

    var osmUrl = 'https://tilecache.openstreetmap.fr/osmfr/{z}/{x}/{y}.png',
                osmAttribution = 'Map data &copy; 2012 OpenStreetMap contributors',
                osm = new L.TileLayer(osmUrl, {maxZoom: 18, attribution: osmAttribution});

    var mapLayer = new L.TileLayer(osmUrl);
    this.map = new L.Map('mapid', options).addLayer(mapLayer);
}

function locateUser(position) {
  var r = 'lat=' + position.coords.latitude + '&lon=' + position.coords.longitude;
  document.getElementsByClassName('loader')[0].classList.add('active');
  document.getElementsByClassName('button')[0].style.display = "none";

  fetch('https://geo.api.gouv.fr/communes?format=geojson&' + r)
  .then(function(response) {
    if (response.ok) {
      return (response.json());
    }
  })
  .then(function(json) {
    var commune = json.features[0];
    console.log(commune);
    L.geoJson(commune).addTo(this.map);
    this.map.setView([position.coords.latitude, position.coords.longitude], zoom=12);
    document.getElementById("nom").innerHTML = commune.properties.nom;
    document.getElementById("codeInsee").innerHTML += commune.properties.codeInsee;
    document.getElementById("codesPostaux").innerHTML += commune.properties.codesPostaux;
    document.getElementById("surface").innerHTML += commune.properties.surface;
    document.getElementById("gps").innerHTML += '</br>longitude: ' + commune.geometry.coordinates[0] + '</br>latitude: ' + commune.geometry.coordinates[1];
  })
  .then(function() {
    document.getElementsByClassName('loader')[0].classList.remove('active');
    document.getElementById('commune').style.display = "block";
  })
  .catch(function(error) {
    document.getElementsByClassName('loader')[0].classList.remove('active');
    document.getElementsByClassName('button')[0].style.display = "block";
    console.log('There has been a problem with your fetch operation: ' + error.message);
});
}

var map = null;
initMap();

</script>
</body>
</html>
